ros2
====

Installation de ros2 (logiciel)
-------------------------------

install 
lien ros2 jazzy 


Workspace ros2 (environnement de travail pour ros2) 
---------------------------------------------------

Package Pantographe_description (package de ros2)
-------------------------------------------------ROS 2
=====

Objectif
--------

L’objectif de cette partie est de mettre en place un environnement ROS 2 propre et reproductible
pour pouvoir :

- organiser les packages du projet
- intégrer l’URDF dans un package de description
- préparer la visualisation RViz

Dans ce TP, ROS 2 est utilisé surtout pour la structure du projet et la future visualisation,
pas uniquement pour exécuter un robot complet.

Vérification de l’installation ROS 2
------------------------------------

La première étape consiste à vérifier si la commande ``ros2`` est disponible.

Problème rencontré
^^^^^^^^^^^^^^^^^^

En essayant d’utiliser ROS2, la commande :

.. code-block:: bash

   ros2

renvoyait :

- ``command not found``

Cela signifie que ROS2 n’est pas chargé dans le terminal (ou que la distribution visée n’est pas installée).

Recherche de la distribution réellement installée
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

On a constaté que le dossier ``/opt/ros/humble`` existait, mais qu’il ne contenait pas les exécutables attendus
(absence du binaire ``ros2``).

Pour confirmer où se trouvait le binaire, on a recherché ``ros2`` sur la machine :

.. code-block:: bash

   command -v ros2 || echo "ros2 introuvable dans PATH"
   sudo find / -type f -name ros2 -perm -111 2>/dev/null | head -n 20

Résultat : le binaire était présent ici :

- ``/opt/ros/jazzy/bin/ros2``

Conclusion
^^^^^^^^^^

ROS2 fonctionnel sur la machine = **ROS 2 Jazzy**.
Le dossier ``/opt/ros/humble`` était présent mais incomplet.

Activation de ROS 2 dans un terminal (source)
---------------------------------------------

Pour utiliser ROS2 dans un terminal, il faut charger l’environnement ROS2 via ``source``.

.. code-block:: bash

   source /opt/ros/jazzy/setup.bash

Pourquoi on fait ça
^^^^^^^^^^^^^^^^^^^

Cette commande configure l’environnement du terminal, notamment :
- ajout des exécutables ROS2 dans le ``PATH`` (ros2, rviz2, etc.)
- configuration des chemins de packages et bibliothèques ROS2

Important : chaque nouveau terminal est indépendant.
Il faut donc faire le ``source`` à chaque fois (ou automatiser via ``~/.bashrc``).

Workspace ROS 2 propre : ``ros2_ws``
------------------------------------

Objectif du workspace
^^^^^^^^^^^^^^^^^^^^^

Un workspace ROS2 est créé pour stocker les packages du projet de manière standard.
Le workspace permet de :

- compiler avec ``colcon build``
- isoler le projet (sans modifier le ROS2 système)
- versionner uniquement le code utile

Création du workspace
^^^^^^^^^^^^^^^^^^^^^

Dans le dépôt Git, on a créé un workspace ROS2 :

.. code-block:: bash

   mkdir -p ros2_ws/src

La convention ROS2 est :

- ``ros2_ws/src`` : code source des packages
- ``ros2_ws/build`` : fichiers de build (générés)
- ``ros2_ws/install`` : workspace compilé (généré)
- ``ros2_ws/log`` : logs (générés)

Compilation du workspace
^^^^^^^^^^^^^^^^^^^^^^^^

.. code-block:: bash

   cd ros2_ws
   colcon build

Activation du workspace
^^^^^^^^^^^^^^^^^^^^^^^

Après compilation, il faut sourcer le workspace pour rendre les packages visibles :

.. code-block:: bash

   source /opt/ros/jazzy/setup.bash
   source ~/docu_info_indus_WATIER_MARMOLLE/ros2_ws/install/setup.bash

Vérification :

.. code-block:: bash

   ros2 pkg list | grep pantograph

Package ``pantograph_description``
----------------------------------

Objectif du package
^^^^^^^^^^^^^^^^^^^

Un package ROS2 de description est créé pour contenir :

- URDF
- meshes (Collada ``.dae``)
- fichiers de lancement (launch)

Création
^^^^^^^^

Depuis ``ros2_ws/src`` :

.. code-block:: bash

   source /opt/ros/jazzy/setup.bash
   cd ros2_ws/src
   ros2 pkg create pantograph_description --build-type ament_python

Pourquoi ``ament_python``
^^^^^^^^^^^^^^^^^^^^^^^^

Le package est principalement un package de fichiers (URDF, meshes, launch),
donc le build type Python est suffisant et simple.
Il permet aussi d’installer facilement des fichiers dans le répertoire ``share/`` du package.

Erreurs rencontrées et solutions
--------------------------------

- **Erreur** : ``ros2: command not found``
  - **Cause** : environnement non sourcé / mauvaise distribution (humble incomplet)
  - **Solution** : utiliser ``/opt/ros/jazzy`` et sourcer correctement :

    .. code-block:: bash

       source /opt/ros/jazzy/setup.bash

- **Erreur** : confusion sur l’endroit où "mettre ROS2"
  - **Clarification** : ROS2 système est dans ``/opt/ros/...`` (on ne le copie jamais)
  - Le projet contient uniquement un workspace ``ros2_ws`` versionné (packages + code)

Lien avec le projet
-------------------

Cette mise en place ROS2 sert directement à :
- structurer proprement le projet dans un workspace standard
- intégrer la description mécanique (URDF + meshes) dans un package dédié
- préparer la visualisation du pantographe dans RViz
